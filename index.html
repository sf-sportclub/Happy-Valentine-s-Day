<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Valentine Message Board</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&family=Mali:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #fff0f5; 
        font-family: 'Kanit', sans-serif;
        background-image: radial-gradient(#ffb7c5 15%, transparent 16%), radial-gradient(#ffb7c5 15%, transparent 16%);
        background-size: 60px 60px;
        background-position: 0 0, 30px 30px;
      }

      /* --- Header --- */
      #main-header {
        position: absolute;
        top: 30px;
        width: 100%;
        text-align: center;
        font-family: 'Mali', cursive;
        font-size: 3rem;
        font-weight: 700;
        color: #ff1493;
        text-shadow: 3px 3px 0px rgba(255, 255, 255, 0.8), 0 0 10px rgba(255, 105, 180, 0.3);
        z-index: 10;
        pointer-events: none;
        user-select: none;
      }

      /* --- Floating/Chat Container --- */
      #floating-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none;
        z-index: 1;
      }

      /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
      .floating-msg {
        position: absolute;
        white-space: nowrap;
        padding: 12px 25px;
        border-radius: 25px;
        background: rgba(255, 255, 255, 0.95);
        box-shadow: 0 4px 15px rgba(255, 105, 180, 0.4);
        font-size: 20px;
        font-family: 'Mali', cursive;
        color: #d63384;
        border: 2px solid #ff69b4;
        user-select: none;
        /* ‡πÉ‡∏ä‡πâ will-change ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏≠‡∏Å Browser ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Render ‡∏Å‡∏£‡∏≤‡∏ü‡∏¥‡∏Å ‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î‡πÅ‡∏•‡πá‡∏Ñ */
        will-change: transform; 
        display: flex;
        flex-direction: column;
      }
      
      .sender-name {
        display: none; 
      }
      
      .msg-content::before {
        content: '‚ù§Ô∏è ';
      }

      /* --- Decorations --- */
      .decoration {
        position: absolute;
        font-size: 3rem;
        opacity: 0.8;
        z-index: 0;
        pointer-events: none;
        animation: float-dec 3s ease-in-out infinite;
      }
      .dec-tl { top: 20px; left: 20px; animation-delay: 0s; }
      .dec-tr { top: 20px; right: 20px; animation-delay: 1s; }
      .dec-bl { bottom: 100px; left: 30px; animation-delay: 0.5s; font-size: 2.5rem; }
      .dec-br { bottom: 100px; right: 30px; animation-delay: 1.5s; font-size: 2.5rem; }

      @keyframes float-dec {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-10px) rotate(5deg); }
      }

      /* --- Input Area --- */
      #input-area {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 650px; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏° Emoji */
        background: rgba(255, 255, 255, 0.95);
        padding: 15px;
        border-radius: 30px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        display: flex;
        gap: 10px;
        z-index: 100;
        border: 3px solid #ff85a2;
        align-items: center;
      }

      #nameInput {
        width: 20%;
        border: none;
        border-bottom: 2px solid #ffb7c5;
        outline: none;
        padding: 10px;
        font-size: 16px;
        font-family: 'Kanit', sans-serif;
        color: #ff69b4;
        background: transparent;
      }
      #nameInput::placeholder {
        color: #ffb7c5;
      }

      #msgInput {
        flex-grow: 1;
        border: none;
        outline: none;
        padding: 10px;
        font-size: 16px;
        font-family: 'Kanit', sans-serif;
        color: #333;
        background: transparent;
      }

      /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î */
      .action-btn {
        background-color: #ff69b4;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: bold;
        transition: transform 0.2s;
        font-family: 'Kanit', sans-serif;
        white-space: nowrap;
      }
      .action-btn:hover {
        background-color: #ff1493;
        transform: scale(1.05);
      }
      .action-btn:disabled {
        background-color: #ffb7c5;
        cursor: not-allowed;
      }

      /* ‡∏õ‡∏∏‡πà‡∏° Emoji */
      #emojiBtn {
        background-color: #fff;
        border: 2px solid #ff69b4;
        color: #ff69b4;
        font-size: 20px;
        padding: 5px 12px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s;
      }
      #emojiBtn:hover {
        background-color: #ffeff5;
        transform: scale(1.1);
      }

      /* --- Emoji Picker Popup --- */
      #emojiPicker {
        display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
        position: absolute;
        bottom: 80px; /* ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ input */
        left: 50%; /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å JS ‡∏õ‡∏£‡∏±‡∏ö */
        transform: translateX(-30%); /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á */
        background: white;
        border: 2px solid #ffb7c5;
        border-radius: 15px;
        padding: 10px;
        width: 280px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        z-index: 101;
        flex-wrap: wrap;
        gap: 5px;
        justify-content: center;
        max-height: 200px;
        overflow-y: auto;
      }
      
      #emojiPicker.show {
        display: flex;
        animation: popUp 0.3s ease-out;
      }

      .emoji-item {
        font-size: 24px;
        padding: 5px;
        cursor: pointer;
        transition: transform 0.1s;
        user-select: none;
      }
      .emoji-item:hover {
        transform: scale(1.3);
      }

      @keyframes popUp {
        from { opacity: 0; transform: translateX(-30%) translateY(10px); }
        to { opacity: 1; transform: translateX(-30%) translateY(0); }
      }

      /* --- Mobile Styles --- */
      @media screen and (max-width: 768px) {
        body { background-size: 30px 30px; }

        #main-header {
          position: fixed;
          top: 0;
          padding: 10px 0;
          background: rgba(255, 240, 245, 0.95);
          font-size: 1.4rem;
          box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .decoration { display: none; }

        #floating-container {
          position: fixed;
          top: 60px;
          bottom: 70px;
          left: 0;
          width: 100%;
          height: auto;
          overflow-y: auto;
          pointer-events: auto;
          display: flex;
          flex-direction: column;
          padding: 10px;
          box-sizing: border-box;
          gap: 6px;
        }

        .floating-msg {
          position: relative !important; 
          left: auto !important;
          top: auto !important;
          transform: none !important;
          white-space: normal;
          word-wrap: break-word;
          max-width: 75%;
          font-size: 14px;
          margin: 0;
          align-self: flex-start;
          animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
          padding: 8px 12px;
          border-radius: 15px;
        }

        .sender-name {
          display: block;
          font-size: 11px;
          color: #ff69b4; 
          font-weight: 600;
          margin-bottom: 2px;
        }

        .floating-msg:nth-child(even) {
          align-self: flex-end;
          background-color: #ffeff5;
          border-color: #ffb7c5;
        }
        
        #input-area {
          width: 96%;
          bottom: 10px;
          padding: 6px;
          border-radius: 20px;
        }
        #nameInput { width: 50px; font-size: 14px; }
        #msgInput { font-size: 14px; }
        .action-btn { padding: 8px 15px; font-size: 14px; }
        
        #emojiPicker {
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            bottom: 60px;
        }
        @keyframes popUp {
            from { opacity: 0; transform: translateX(-50%) translateY(10px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
      }

      @keyframes popIn {
        from { transform: scale(0.5); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
      }

      .heart-particle {
        position: fixed;
        color: #ff1493;
        font-size: 20px;
        animation: floatUp 2s ease-out forwards;
        pointer-events: none;
        z-index: 999;
      }

      @keyframes floatUp {
        0% { transform: translateY(0) scale(1); opacity: 1; }
        100% { transform: translateY(-100px) scale(1.5); opacity: 0; }
      }
    </style>
  </head>
  <body>

    <div id="main-header">SF Valentine Message Board üíñ</div>

    <div class="decoration dec-tl">üíå</div>
    <div class="decoration dec-tr">üß∏</div>
    <div class="decoration dec-bl">üåπ</div>
    <div class="decoration dec-br">üç´</div>

    <div id="floating-container"></div>

    <div id="input-area">
      <!-- Popup Emoji -->
      <div id="emojiPicker"></div>

      <input type="text" id="nameInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠..." maxlength="20">
      <input type="text" id="msgInput" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." maxlength="50">
      
      <!-- ‡∏õ‡∏∏‡πà‡∏° Emoji -->
      <button id="emojiBtn" onclick="toggleEmojiPicker()">üòä</button>
      
      <button onclick="submitMessage()" id="sendBtn" class="action-btn">‡∏™‡πà‡∏á ‚ù§Ô∏è</button>
    </div>

    <script>
      // =========================================================
      // ‚ö†Ô∏è‚ö†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ: ‡∏ô‡∏≥ URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Google Script ‡∏°‡∏≤‡πÉ‡∏™‡πà ‚ö†Ô∏è‚ö†Ô∏è
      // =========================================================
      const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwmAocSQ4bwYrYitjiaxWq0yswxc1O3TDZa-w3iaz9h3SNkL7YlJuw4vq9Bf_y1cWrS/exec"; 
      
      // ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
      const MAX_MESSAGES = 30; // ‚ö°Ô∏è ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏Ñ‡πà 30 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡πÅ‡∏•‡πá‡∏Ñ

      let existingMessages = [];
      let floatingElements = [];
      let isMobile = false;
      let hasAlertedError = false;

      // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Emoji ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      const emojis = [
        "‚ù§Ô∏è", "üíñ", "üíò", "üíù", "üíì", "üíó", "üíû", "üíï", "üíü", "‚ù£Ô∏è", 
        "üòç", "ü•∞", "üòò", "üòö", "üòª", "ü§©", "ü§™", "üòá", "ü•≥", "üòé",
        "üåπ", "üíê", "üå∑", "üåª", "üåº", "üå∏", "üå∫", "üç´", "üç¨", "üç≠",
        "üß∏", "üéÅ", "üéÄ", "üéà", "üéâ", "‚ú®", "üí´", "‚≠êÔ∏è", "üåô", "‚òÅÔ∏è"
      ];

      window.onload = function() {
        checkLayout(); 
        window.addEventListener('resize', checkLayout);
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Emoji Picker
        createEmojiPicker();

        if (WEB_APP_URL.includes("URL_‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å") || WEB_APP_URL === "") {
             alert("‚ö†Ô∏è ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå Web App URL ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!");
             return;
        }

        fetchData(); 
        requestAnimationFrame(animateLoop);
        setInterval(fetchData, 4000);
      };

      // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Emoji ---
      function createEmojiPicker() {
        const picker = document.getElementById('emojiPicker');
        emojis.forEach(emoji => {
            const span = document.createElement('span');
            span.textContent = emoji;
            span.className = 'emoji-item';
            span.onclick = () => {
                const msgInput = document.getElementById('msgInput');
                msgInput.value += emoji;
                msgInput.focus();
                // toggleEmojiPicker(); // ‡∏õ‡∏¥‡∏î popup ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏±‡∏ô‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ comment ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ)
            };
            picker.appendChild(span);
        });
      }

      function toggleEmojiPicker() {
        const picker = document.getElementById('emojiPicker');
        picker.classList.toggle('show');
      }

      // ‡∏õ‡∏¥‡∏î Emoji ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô
      document.addEventListener('click', function(event) {
        const picker = document.getElementById('emojiPicker');
        const btn = document.getElementById('emojiBtn');
        if (!picker.contains(event.target) && !btn.contains(event.target)) {
            picker.classList.remove('show');
        }
      });

      function checkLayout() {
        const wasMobile = isMobile;
        isMobile = window.innerWidth <= 768;

        if (wasMobile !== isMobile) {
          const container = document.getElementById('floating-container');
          const msgs = document.querySelectorAll('.floating-msg');
          if (isMobile) {
            msgs.forEach(el => {
              el.style.left = '';
              el.style.top = '';
            });
            setTimeout(() => { container.scrollTop = container.scrollHeight; }, 100);
          }
        }
      }

      function fetchData() {
        if (WEB_APP_URL.includes("URL_‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å")) return;

        fetch(WEB_APP_URL)
          .then(response => {
             if (!response.ok) throw new Error("Network response was not ok");
             return response.json();
          })
          .then(data => {
            updateBoard(data);
            hasAlertedError = false;
          })
          .catch(error => {
            console.error('Error:', error);
            if (!hasAlertedError && error.name === "SyntaxError") {
                alert("‚ö†Ô∏è ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ! ‡πÄ‡∏ä‡πá‡∏Ñ URL ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Anyone");
                hasAlertedError = true;
            }
          });
      }

      function updateBoard(messages) {
        // ‡∏ñ‡πâ‡∏≤ Backend ‡∏™‡πà‡∏á‡∏°‡∏≤‡πÄ‡∏¢‡∏≠‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏î‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà 30 ‡∏≠‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• (‡πÄ‡∏ú‡∏∑‡πà‡∏≠ Backend ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πâ)
        // ‡πÅ‡∏ï‡πà‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà createFloatingText ‡∏î‡πâ‡∏ß‡∏¢
        
        if (messages.length > existingMessages.length) {
          // ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
          let newMsgs = messages.slice(existingMessages.length);
          
          newMsgs.forEach(msgData => {
            createFloatingText(msgData);
          });

          existingMessages = messages;
        }
      }

      function createFloatingText(data) {
        // ‚ö°Ô∏è‚ö°Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô 30 ‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏≠‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏≠‡∏≠‡∏Å (FIFO) ‚ö°Ô∏è‚ö°Ô∏è
        if (floatingElements.length >= MAX_MESSAGES) {
            const oldest = floatingElements.shift(); // ‡πÄ‡∏≠‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å (‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î) ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Array
            if (oldest && oldest.element) {
                oldest.element.remove(); // ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            }
        }

        const container = document.getElementById('floating-container');
        const el = document.createElement('div');
        el.className = 'floating-msg';
        
        const senderName = (data.name && data.name.trim() !== "") ? data.name : "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô";
        
        el.innerHTML = `
          <div class="sender-name">${senderName}</div>
          <div class="msg-content">${data.text}</div>
        `;
        
        // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        const startX = Math.random() * (window.innerWidth - 100);
        const startY = 100 + Math.random() * (window.innerHeight - 250); 
        
        if (!isMobile) {
            el.style.left = startX + 'px';
            el.style.top = startY + 'px';
        }
        
        container.appendChild(el);

        let speed = 0.4 + Math.random() * 0.8;
        let angle = Math.random() * Math.PI * 2;

        floatingElements.push({
          element: el,
          x: startX,
          y: startY,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          width: 0,
          height: 0
        });

        if (isMobile) {
            setTimeout(() => { container.scrollTop = container.scrollHeight; }, 50);
        }
      }

      function animateLoop() {
        if (!isMobile) {
            const containerW = window.innerWidth;
            const containerH = window.innerHeight;

            // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà (‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 30 ‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÅ‡∏•‡πá‡∏Ñ)
            floatingElements.forEach(item => {
              if (item.width === 0) {
                item.width = item.element.offsetWidth;
                item.height = item.element.offsetHeight;
              }

              item.x += item.vx;
              item.y += item.vy;

              // ‡∏ä‡∏ô‡∏Ç‡∏≠‡∏ö‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏ß‡∏≤
              if (item.x <= 0 || item.x + item.width >= containerW) {
                item.vx *= -1;
                item.x = Math.max(0, Math.min(item.x, containerW - item.width));
              }

              // ‡∏ä‡∏ô‡∏Ç‡∏≠‡∏ö‡∏ö‡∏ô‡∏•‡πà‡∏≤‡∏á
              if (item.y <= 0 || item.y + item.height >= containerH) {
                item.vy *= -1;
                item.y = Math.max(0, Math.min(item.y, containerH - item.height));
              }

              // ‡πÉ‡∏ä‡πâ transform ‡πÅ‡∏ó‡∏ô top/left ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô (‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏´‡∏ß) 
              // ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ top/left ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡πá‡πÇ‡∏≠‡πÄ‡∏Ñ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡πâ‡∏≠‡∏¢
              item.element.style.left = item.x + 'px';
              item.element.style.top = item.y + 'px';
            });
        }
        requestAnimationFrame(animateLoop);
      }

      function submitMessage() {
        if (WEB_APP_URL.includes("URL_‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å")) {
             alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Web App ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°");
             return;
        }

        const msgInput = document.getElementById('msgInput');
        const nameInput = document.getElementById('nameInput');
        const btn = document.getElementById('sendBtn');
        
        const text = msgInput.value.trim();
        const name = nameInput.value.trim();

        if (text === "") return;

        btn.disabled = true;
        btn.innerText = "‡∏™‡πà‡∏á...";

        fetch(WEB_APP_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ text: text, name: name })
        })
        .then(() => {
          msgInput.value = "";
          btn.disabled = false;
          btn.innerText = "‡∏™‡πà‡∏á ‚ù§Ô∏è";
          msgInput.focus();
          createHeartEffect();
          
          document.getElementById('emojiPicker').classList.remove('show'); // ‡∏õ‡∏¥‡∏î emoji ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
          setTimeout(fetchData, 1000);
        })
        .catch(err => {
          console.error(err);
          btn.disabled = false;
          btn.innerText = "‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà";
        });
      }

      document.getElementById('msgInput').addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
          submitMessage();
        }
      });

      function createHeartEffect() {
        const heart = document.createElement('div');
        heart.innerText = 'üíñ';
        heart.className = 'heart-particle';
        heart.style.left = (window.innerWidth / 2) + 'px';
        heart.style.bottom = '80px';
        document.body.appendChild(heart);
        setTimeout(() => heart.remove(), 2000);
      }
    </script>
  </body>
</html>
